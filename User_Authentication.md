Authentication is the process of verifying the identity of a client. When access control is enabled, MongoDB requires all clients to authenticate themselves in order to determine their access.

Although authentication and authorization are closely connected, authentication is distinct from authorization:

Authentication verifies the identity of a user.

Authorization determines the verified user's access to resources and operations.

Authentication Mechanisms

- SCRAM Authentication
Salted Challenge Response Authentication Mechanism (SCRAM) is the default authentication mechanism for MongoDB. When a user authenticates themselves, MongoDB uses SCRAM to verify the supplied user credentials against the user's name, password, and authentication database.

SCRAM is based on the IETF RFC 5802 standard that defines best practices for the implementation of challenge-response mechanisms for authenticating users with passwords.

Features

MongoDB's implementation of SCRAM provides:

-  A tunable work factor (the iteration count)
- Per-user random salts
- Bi-directional authentication between server and client
MongoDB supports the following SCRAM mechanisms: SCRAM-SHA-1, SCRAM-SHA-256.

When you create or update a SCRAM user, you can indicate the SCRAM mechanism to use whether the server or the client digests the password. When you use SCRAM-SHA-256, MongoDB requires server-side password hashing, which means that the server digests the password.
       

- x.509 Certificate Authentication
  MongoDB supports x.509 certificate authentication for client authentication and internal authentication of the members of 
  replica sets and sharded clusters. x.509 certificate authentication requires a secure TLS/SSL connection.
  To use MongoDB with x.509, you must use valid certificates generated and signed by a certificate authority. The client 
  x.509 certificates must meet the client certificate requirements.
  
  Certificate Authority
  
   For production use, your MongoDB deployment should use valid certificates generated and signed by a certificate authority. You or your organization can generate and maintain an independent certificate authority, or use certificates generated by third-party TLS vendors. Obtaining and managing certificates is beyond the scope of this documentation.

  Client x.509 Certificates
  
To authenticate to servers, clients can use x.509 certificates instead of usernames and passwords.

Client Certificate Requirements

Client certificate requirements:

A single Certificate Authority (CA) must issue the certificates for both the client and the server.

Each unique MongoDB user must have a unique certificate.

The x.509 certificate must not be expired.

Client certificates must contain the following fields:

keyUsage = digitalSignature
extendedKeyUsage = clientAuth

At least one of the following client certificate attributes must be different than the attributes in both the net.tls.clusterFile and net.tls.certificateKeyFile server certificates:

- Organization (O)

- Organizational Unit (OU)

- Domain Component (DC)

The subject of a client x.509 certificate, which contains the Distinguished Name (DN), must be different than the subjects of member x.509 certificates.

- MongoDB User and $external Database

To authenticate with a client certificate, you must first add the client certificate's subject as a MongoDB user in the $external database. The $external database is the Authentication Database for the user.

To use Client Sessions and Causal Consistency Guarantees with $external authentication users (Kerberos, LDAP, or x.509 users), usernames cannot be greater than 10k bytes.

- MongoDB Configuration for Membership Authentication

- MongoDB Configuration for Membership Authentication
  
You can use TLS for internal authentication between each member of your replica set (each mongod instance) or sharded cluster (each mongod and mongos instance).

To use TLS for internal authentication, use the following settings:

security.clusterAuthMode or --clusterAuthMode set to x509

net.tls.clusterFile or --tlsClusterFile (available starting in MongoDB 4.2)

- Kerberos Authentication

  In a Kerberos-based system, every participant in the authenticated communication is known as a "principal", and every principal must have a unique name.

Principals belong to administrative units called realms. For each realm, the Kerberos Key Distribution Center (KDC) maintains a database of the realm's principal and the principals' associated "secret keys".

For a client-server authentication, the client requests from the KDC a "ticket" for access to a specific asset. KDC uses the client's secret and the server's secret to construct the ticket which allows the client and server to mutually authenticate each other, while keeping the secrets hidden.

  User Principal

To authenticate using Kerberos, you must add the Kerberos user principals to MongoDB to the $external database. User principal names have the form:

```<username>@<KERBEROS REALM>```

For every user you want to authenticate using Kerberos, you must create a corresponding user in MongoDB in the $external database.

  Service Principal

  Every MongoDB mongod and mongos instance (or mongod.exe or mongos.exe on Windows) must have an associated service principal. Service principal names have the form:

```<service>/<fully qualified domain name>@<KERBEROS REALM>```

Linux Keytab Files
Linux systems can store Kerberos authentication keys for a 
service principal
 in keytab files. Each Kerberized mongod and mongos instance running on Linux must have access to a keytab file containing keys for its 
service principal.
Configure MongoDB with Kerberos Authentication on Linux
In order to use MongoDB with Kerberos, a Kerberos service principal for each mongod and mongos instance in your MongoDB deployment must be 
added to the Kerberos database
. You can add the service principal by running a command similar to the following on your KDC:

```kadmin.local addprinc mongodb/m1.example.com@EXAMPLE.COM```

You can create the keytab file by running a command similar to the following on the system running mongod or mongos:

```kadmin.local ktadd mongodb/m1.example.com@EXAMPLE.COM```

Procedure

- Start mongod without Kerberos
- Connect to mongod
- Add Kerberos Principal(s) to MongoDB.
 ```use $external
db.createUser(
   {
     user: "application/reporting@EXAMPLE.NET",
     roles: [ { role: "read", db: "records" } ]
   }
)
```
- Start mongod with Kerberos support.
``` env KRB5_KTNAME=<path to keytab file> \
mongod \
--setParameter authenticationMechanisms=GSSAPI \
<additional mongod options>  
```

``` env KRB5_KTNAME=/opt/mongodb/mongod.keytab \
/opt/mongodb/bin/mongod --auth \
--setParameter authenticationMechanisms=GSSAPI \
--dbpath /opt/mongodb/data --bind_ip localhost,<hostname(s)|ip address(es)>
 ```

-  Connect mongosh to mongod and authenticate

```mongosh --host hostname.example.net --authenticationMechanism=GSSAPI --authenticationDatabase='$external' --username application/reporting@EXAMPLE.NET
```

```use $external
db.auth( { mechanism: "GSSAPI", user: "application/reporting@EXAMPLE.NET" } )
```

Configure mongos for Kerberos

``` env KRB5_KTNAME=<path to keytab file> \
mongos \
--setParameter authenticationMechanisms=GSSAPI \
<additional mongos options>
 ```

Use a Config File

To configure mongod or mongos for Kerberos support using a configuration file, specify the authenticationMechanisms setting in the configuration file.

```setParameter: authenticationMechanisms: GSSAPI```

Configure MongoDB with Kerberos Authentication on Windows

Procedures

- Start mongod.exe without Kerberos.
- Connect to mongod.
- Add Kerberos Principal(s) to MongoDB.
- The following example adds the Kerberos principal reportingapp@EXAMPLE.NET with read-only access to the records database

```use $external
db.createUser(
   {
     user: "reportingapp@EXAMPLE.NET",
     roles: [ { role: "read", db: "records" } ]
   }
)
```

- Start mongod.exe with Kerberos support.

```
mongod.exe --setParameter authenticationMechanisms=GSSAPI <additional mongod.exe options>
 ```

- Connect mongo.exe shell to mongod.exe and authenticate.

 Using cmd.exe:

```
mongo.exe --host hostname.example.net --authenticationMechanism=GSSAPI --authenticationDatabase=$external --username reportingapp@EXAMPLE.NET
 ```

 Using Windows PowerShell:

``` 
mongo.exe --host hostname.example.net --authenticationMechanism=GSSAPI --authenticationDatabase='$external' --username reportingapp@EXAMPLE.NET
```

If you are connecting to a system whose hostname does not match the Kerberos name, first connect mongo.exe to the mongod.exe, and then from the mongo.exe shell, use the db.auth() method to authenticate in the $external database.

```
 use $external
db.auth( { mechanism: "GSSAPI", user: "reportingapp@EXAMPLE.NET" } )
```

- Additional Considerations

- Configure mongos.exe for Kerberos

```
mongos.exe --setParameter authenticationMechanisms=GSSAPI <additional mongos options>
```

- Assign Service Principal Name to MongoDB Windows Service

``` 
setspn.exe -S <service>/<fully qualified domain name> <service account name>
```

- Incorporate Additional Authentication Mechanisms

- Kerberos authentication (GSSAPI (Kerberos)) can work alongside:

- MongoDB's SCRAM authentication mechanism:

   SCRAM-SHA-1

   SCRAM-SHA-256 (Added in MongoDB 4.0)

- MongoDB's authentication mechanism for LDAP:

   PLAIN (LDAP SASL)

- MongoDB's authentication mechanism for x.509:

   MONGODB-X509)

Specify the mechanisms as follows:

```
--setParameter authenticationMechanisms=GSSAPI,SCRAM-SHA-256
```









- LDAP Proxy Authentication
  MongoDB Enterprise supports proxy authentication through a Lightweight Directory Access Protocol (LDAP) service.
  
  Previous versions of MongoDB support authentication against an LDAP server using simple and SASL binding via saslauthd.

  This restricted LDAP authentication support to only Linux MongoDB deployments.
  
  MongoDB supports simple and SASL binding to LDAP servers via Operating system libraries , saslauthd
  
  MongoDB can provide professional services for optimal configuration of LDAP authentication for your MongoDB deployment.
  
  Connection Pool
  
  Starting in version 4.2.0, when connecting to the LDAP server for authentication/authorization, MongoDB, by default:
  
  Uses connection pooling if run:
  
  on Windows or on Linux where MongoDB Enterprise binaries are linked against  libldap_r.
  
  Does not use connection pooling if run: on Linux where MongoDB Enterprise binaries are linked against libldap.
  
  To change the connection pooling behavior, update the ldapUseConnectionPool parameter.
- OpenID Connect Authentication
- Internal / Membership Authentication
